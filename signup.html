<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign up</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="login-reg.css" />
  </head>

  <body>
    <div class="register-photo">
      <div class="form-container">
        <div class="image-holder"></div>
        <form id="loginForm" method="post">
          <h2 class="text-center"><strong>Create</strong> an account.</h2>
          <div class="form-group">
            <input
              class="form-control"
              required="true"
              type="text"
              name="name"
              placeholder="Name"
            />
          </div>
          <div class="form-group">
            <input
              class="form-control"
              required="true"
              id="email"
              type="email"
              name="email"
              placeholder="Email"
            />
            <span id="emailValidationError" style="color:red; display:none;">Invalid email format.</span>
          </div>
          <div class="form-group">
            <input
              class="form-control"
              required="true"
              type="password"
              name="password"
              placeholder="Password"
            />
          </div>
          <div class="form-group">
            <input
              class="form-control"
              required="true"
              type="password"
              name="password-repeat"
              placeholder="Password (repeat)"
            />
          </div>
          <span
            id="passwordMismatchMessage"
            style="color: red; display: none"
          ></span>
          <div class="form-group">
            <button class="btn btn-primary btn-block" type="submit">
              Sign Up
            </button>
          </div>
          <a href="#" class="already"
            >You already have an account? Login here.</a
          >
        </form>
      </div>
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        var loginForm = document.getElementById("loginForm");

        loginForm.addEventListener("submit", function (event) {
          event.preventDefault(); // Prevent the form from submitting via the browser.

          var passwordInput = document.querySelector('input[name="password"]');
          var passwordRepeatInput = document.querySelector(
            'input[name="password-repeat"]'
          );

          var emailInput = document.getElementById("email");
          var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/; // Simple email validation regex
          if (!emailRegex.test(emailInput.value)) {
            emailValidationError.style.display = "block";
            return; // Exit the function early
          }
          emailValidationError.style.display = "none";
          // Check if passwords match
          if (passwordInput.value !== passwordRepeatInput.value) {
            passwordMismatchMessage.style.display = "block"; // Show the message
            passwordMismatchMessage.textContent = "Passwords do not match."; // Update the message text
            return; // Exit the function early
          }

          passwordMismatchMessage.style.display = "none";
          var formData = new FormData(loginForm); // Create a FormData object

          // Convert FormData to JSON
          var jsonData = {};
          formData.forEach(function (value, key) {
            if(key!='password-repeat'){
                jsonData[key] = value;
            }
          });
          console.log(jsonData);

          // Send the POST request
          fetch("http://127.0.0.1:8000/auth/user/", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify(jsonData),
          })
            .then((response) => response.json())
            .then((data) => {
              if (data !== null) {
                // Assuming the server responds with a 'success' property
                window.location.href = "login.html"; // Redirect to index.html
              } else {
                // Handle unsuccessful authentication
                console.error("Authentication failed");
              }
              // Handle success (e.g., redirect to another page)
            })
            .catch((error) => {
              console.error("Error:", error);
              // Handle errors (e.g., show an error message)
            });
        });
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
